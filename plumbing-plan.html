<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#0c1929">
    <title>PlansiteOS | Plumbing Plan Generator</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="/css/shared.css">
    <link rel="stylesheet" href="/css/plumbing-plan.css">
</head>
<body>
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HEADER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <header>
        <div class="header-container">
            <a href="/index.html" class="logo">
                Plansite<span class="logo-accent">OS</span>
            </a>
            <div class="plan-title-container">
                <input type="text" id="planTitle" class="plan-title-input" value="Untitled Plumbing Plan" />
                <span class="plan-status" id="planStatus">Saved</span>
            </div>
            <div class="header-actions">
                <button class="btn btn-ghost btn-sm" id="newPlanBtn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"/>
                        <line x1="5" y1="12" x2="19" y2="12"/>
                    </svg>
                    New
                </button>
                <button class="btn btn-ghost btn-sm" id="savePlanBtn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                        <polyline points="17 21 17 13 7 13 7 21"/>
                        <polyline points="7 3 7 8 15 8"/>
                    </svg>
                    Save
                </button>
                <button class="btn btn-primary btn-sm" id="exportBtn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="7 10 12 15 17 10"/>
                        <line x1="12" y1="15" x2="12" y2="3"/>
                    </svg>
                    Export PDF
                </button>
            </div>
        </div>
        <div class="nav-tabs">
            <a href="/index.html" class="nav-tab">
                <span>üè†</span> Dashboard
            </a>
            <a href="/analysis.html" class="nav-tab">
                <span>üìê</span> Analysis
            </a>
            <a href="/plumbing-plan.html" class="nav-tab active">
                <span>‚úèÔ∏è</span> Plan Generator
            </a>
            <a href="/documents.html" class="nav-tab">
                <span>üìÅ</span> Documents
            </a>
        </div>
    </header>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MAIN WORKSPACE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="workspace">
        <!-- LEFT SIDEBAR: Tools & Fixtures -->
        <aside class="sidebar sidebar-left">
            <!-- Tool Palette -->
            <div class="panel">
                <div class="panel-header">
                    <h3 class="panel-title">Tools</h3>
                </div>
                <div class="panel-body">
                    <div class="tool-grid">
                        <button class="tool-btn active" data-tool="select" title="Select (V)">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 3l7.07 16.97 2.51-7.39 7.39-2.51L3 3z"/>
                            </svg>
                            <span>Select</span>
                        </button>
                        <button class="tool-btn" data-tool="wall" title="Wall (W)">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="18" height="18"/>
                            </svg>
                            <span>Wall</span>
                        </button>
                        <button class="tool-btn" data-tool="pipe-supply" title="Supply Pipe (S)">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="5" y1="12" x2="19" y2="12"/>
                            </svg>
                            <span>Supply</span>
                        </button>
                        <button class="tool-btn" data-tool="pipe-waste" title="Waste Pipe (D)">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                                <line x1="5" y1="12" x2="19" y2="12"/>
                            </svg>
                            <span>Waste</span>
                        </button>
                        <button class="tool-btn" data-tool="pipe-vent" title="Vent Pipe (T)">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-dasharray="4 2">
                                <line x1="5" y1="12" x2="19" y2="12"/>
                            </svg>
                            <span>Vent</span>
                        </button>
                        <button class="tool-btn" data-tool="dimension" title="Dimension (M)">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="4" y1="12" x2="20" y2="12"/>
                                <polyline points="8 8 4 12 8 16"/>
                                <polyline points="16 8 20 12 16 16"/>
                            </svg>
                            <span>Measure</span>
                        </button>
                        <button class="tool-btn" data-tool="text" title="Text (T)">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="4 7 4 4 20 4 20 7"/>
                                <line x1="9" y1="20" x2="15" y2="20"/>
                                <line x1="12" y1="4" x2="12" y2="20"/>
                            </svg>
                            <span>Text</span>
                        </button>
                        <button class="tool-btn" data-tool="pan" title="Pan (Space)">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M5 9l-3 3 3 3M9 5l3-3 3 3M15 19l-3 3-3-3M19 9l3 3-3 3M2 12h20M12 2v20"/>
                            </svg>
                            <span>Pan</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Fixture Library -->
            <div class="panel">
                <div class="panel-header">
                    <h3 class="panel-title">Fixtures</h3>
                    <input type="text" class="search-input" placeholder="Search..." id="fixtureSearch" />
                </div>
                <div class="panel-body">
                    <div class="fixture-categories">
                        <button class="category-btn active" data-category="all">All</button>
                        <button class="category-btn" data-category="bathroom">Bathroom</button>
                        <button class="category-btn" data-category="kitchen">Kitchen</button>
                        <button class="category-btn" data-category="utility">Utility</button>
                    </div>
                    <div class="fixture-list" id="fixtureList">
                        <!-- Fixtures will be loaded dynamically -->
                    </div>
                </div>
            </div>

            <!-- Templates -->
            <div class="panel">
                <div class="panel-header">
                    <h3 class="panel-title">Templates</h3>
                </div>
                <div class="panel-body">
                    <div class="template-list">
                        <button class="template-btn" data-template="full-bath">
                            <span class="template-icon">üõÅ</span>
                            <span>Full Bathroom</span>
                        </button>
                        <button class="template-btn" data-template="half-bath">
                            <span class="template-icon">üöΩ</span>
                            <span>Half Bathroom</span>
                        </button>
                        <button class="template-btn" data-template="kitchen">
                            <span class="template-icon">üç≥</span>
                            <span>Kitchen</span>
                        </button>
                        <button class="template-btn" data-template="laundry">
                            <span class="template-icon">üëï</span>
                            <span>Laundry Room</span>
                        </button>
                    </div>
                </div>
            </div>
        </aside>

        <!-- CENTER: Canvas -->
        <main class="canvas-container">
            <!-- Top Toolbar -->
            <div class="canvas-toolbar">
                <div class="toolbar-group">
                    <button class="toolbar-btn" id="undoBtn" title="Undo (Ctrl+Z)">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 7v6h6"/>
                            <path d="M21 17a9 9 0 00-9-9 9 9 0 00-6 2.3L3 13"/>
                        </svg>
                    </button>
                    <button class="toolbar-btn" id="redoBtn" title="Redo (Ctrl+Y)">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 7v6h-6"/>
                            <path d="M3 17a9 9 0 019-9 9 9 0 016 2.3l3 2.7"/>
                        </svg>
                    </button>
                </div>
                <div class="toolbar-divider"></div>
                <div class="toolbar-group">
                    <button class="toolbar-btn" id="deleteBtn" title="Delete (Del)">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="3 6 5 6 21 6"/>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                        </svg>
                    </button>
                    <button class="toolbar-btn" id="duplicateBtn" title="Duplicate (Ctrl+D)">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                        </svg>
                    </button>
                </div>
                <div class="toolbar-divider"></div>
                <div class="toolbar-group">
                    <label class="toolbar-label">
                        Grid:
                        <input type="checkbox" id="gridToggle" checked />
                    </label>
                    <label class="toolbar-label">
                        Snap:
                        <input type="checkbox" id="snapToggle" checked />
                    </label>
                </div>
                <div class="toolbar-spacer"></div>
                <div class="toolbar-group">
                    <button class="toolbar-btn" id="zoomOutBtn" title="Zoom Out (-)">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"/>
                            <line x1="8" y1="11" x2="14" y2="11"/>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"/>
                        </svg>
                    </button>
                    <span class="zoom-level" id="zoomLevel">100%</span>
                    <button class="toolbar-btn" id="zoomInBtn" title="Zoom In (+)">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"/>
                            <line x1="11" y1="8" x2="11" y2="14"/>
                            <line x1="8" y1="11" x2="14" y2="11"/>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"/>
                        </svg>
                    </button>
                    <button class="toolbar-btn" id="zoomFitBtn" title="Fit to Screen">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Drawing Canvas -->
            <div class="canvas-wrapper" id="canvasWrapper">
                <canvas id="mainCanvas"></canvas>
                <div class="canvas-info" id="canvasInfo">
                    <span id="cursorPosition">X: 0, Y: 0</span>
                </div>
            </div>
        </main>

        <!-- RIGHT SIDEBAR: Properties & Layers -->
        <aside class="sidebar sidebar-right">
            <!-- Properties Panel -->
            <div class="panel">
                <div class="panel-header">
                    <h3 class="panel-title">Properties</h3>
                </div>
                <div class="panel-body" id="propertiesPanel">
                    <div class="empty-state-sm">
                        <p>Select an object to view properties</p>
                    </div>
                </div>
            </div>

            <!-- Layers Panel -->
            <div class="panel">
                <div class="panel-header">
                    <h3 class="panel-title">Layers</h3>
                    <button class="icon-btn-sm" id="addLayerBtn" title="Add Layer">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"/>
                            <line x1="5" y1="12" x2="19" y2="12"/>
                        </svg>
                    </button>
                </div>
                <div class="panel-body">
                    <div class="layer-list" id="layerList">
                        <!-- Layers will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Scale & Units -->
            <div class="panel">
                <div class="panel-header">
                    <h3 class="panel-title">Drawing Settings</h3>
                </div>
                <div class="panel-body">
                    <div class="setting-row">
                        <label>Scale</label>
                        <select id="scaleSelect" class="setting-select">
                            <option value="0.25">1/4" = 1'</option>
                            <option value="0.5">1/2" = 1'</option>
                            <option value="1">1" = 1'</option>
                        </select>
                    </div>
                    <div class="setting-row">
                        <label>Units</label>
                        <select id="unitsSelect" class="setting-select">
                            <option value="imperial">Imperial (ft/in)</option>
                            <option value="metric">Metric (m/cm)</option>
                        </select>
                    </div>
                    <div class="setting-row">
                        <label>Grid Size</label>
                        <input type="number" id="gridSize" class="setting-input" value="12" min="6" max="48" />
                    </div>
                </div>
            </div>
        </aside>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Export Modal -->
    <div class="modal-overlay" id="exportModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Export Plan</h3>
                <button class="icon-btn" id="closeExportModal">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="export-options">
                    <div class="export-option">
                        <label>
                            <input type="radio" name="exportFormat" value="pdf" checked />
                            <div class="export-option-content">
                                <div class="export-option-icon">üìÑ</div>
                                <div>
                                    <div class="export-option-title">PDF Document</div>
                                    <div class="export-option-desc">Professional PDF for printing and sharing</div>
                                </div>
                            </div>
                        </label>
                    </div>
                    <div class="export-option">
                        <label>
                            <input type="radio" name="exportFormat" value="png" />
                            <div class="export-option-content">
                                <div class="export-option-icon">üñºÔ∏è</div>
                                <div>
                                    <div class="export-option-title">PNG Image</div>
                                    <div class="export-option-desc">High-resolution image file</div>
                                </div>
                            </div>
                        </label>
                    </div>
                    <div class="export-option">
                        <label>
                            <input type="radio" name="exportFormat" value="json" />
                            <div class="export-option-content">
                                <div class="export-option-icon">üíæ</div>
                                <div>
                                    <div class="export-option-title">Save to Documents</div>
                                    <div class="export-option-desc">Save for later editing</div>
                                </div>
                            </div>
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-ghost" id="cancelExportBtn">Cancel</button>
                <button class="btn btn-primary" id="confirmExportBtn">Export</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="/js/shared.js"></script>
    <script src="/js/plumbing-symbols.js"></script>
    <script src="/js/plumbing-plan-engine.js"></script>
    <script src="/js/plumbing-plan.js"></script>
</body>
</html>

# PlansiteOS - Caddy Configuration for Tailscale Access
# Accessible via http://100.109.158.92:8081

:80 {
  encode zstd gzip

  # API routes
  @api path /api/*
  reverse_proxy @api api:8000

  # Health check endpoint
  @health path /health
  respond @health 200

  # Frontend (all other requests)
  reverse_proxy frontend:4173

  # Security headers
  header {
    X-Content-Type-Options "nosniff"
    X-Frame-Options "SAMEORIGIN"
    Referrer-Policy "strict-origin-when-cross-origin"
    X-XSS-Protection "1; mode=block"
  }

  # Large file uploads for blueprints (200MB limit)
  @upload path /api/blueprints/* /api/projects/*/uploads
  request_body @upload {
    max_size 200MB
  }

  # Access logs
  log {
    output file /var/log/caddy/access.log
    format json
  }
}
